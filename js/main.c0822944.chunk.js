(this.webpackJsonpwbdb=this.webpackJsonpwbdb||[]).push([[0],{239:function(e,t,n){e.exports=n(587)},251:function(e,t,n){},252:function(e,t,n){},253:function(e,t,n){},254:function(e,t,n){},255:function(e,t,n){},266:function(e,t,n){},267:function(e,t,n){},270:function(e,t,n){},271:function(e,t,n){},272:function(e,t,n){},273:function(e,t,n){},274:function(e,t,n){},275:function(e,t,n){},276:function(e,t,n){},277:function(e,t,n){},278:function(e,t,n){},279:function(e,t,n){},280:function(e,t,n){},585:function(e,t,n){},586:function(e,t,n){},587:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(62),c=n(4),o=n(63),u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_DATATREE":return t.new_data_tree;default:return e}},l=n(17),s=n(20),f=n(13),d=n(233),m=n(25),p=n.n(m),v=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,a=[];switch(n.type){case"SET_ACTIVE_FRAMES":return(a=n.active_frames_list.reverse()).forEach((function(e){return e.focussed=!1})),a[0].focussed=!0,a;case"CLEAR_FRAMES":return[];case"ADD_ACTIVE_FRAMES":(a=n.new_frames).forEach((function(e){return e.focussed=!1})),a[0].focussed=!0;var r=t.map((function(e){return Object(d.a)({},e,{focussed:!1})}));return[].concat(Object(f.a)(a),Object(f.a)(r));case"REMOVE_ONE_OF_ACTIVE_FRAMES":var i,c=t.indexOf(n.frame_to_remove);i=t.length>1&c+1<t.length?c+1:c+1===t.length&0!==c?c-1:c;var o=[];return o=t[c].focussed?p()(t,Object(s.a)({},i,{focussed:{$set:!0}})):t,[].concat(Object(f.a)(o.slice(0,c)),Object(f.a)(o.slice(c+1)));case"SET_FOCUS":var u=t.indexOf(n.frame),m=t.findIndex((function(e){return!0===e.focussed})),v=p()(t,(e={},Object(s.a)(e,m,{focussed:{$set:!1}}),Object(s.a)(e,u,{focussed:{$set:!0}}),e));return v;case"FOCUS_NEXT":var E=function(e){var n,a=t.indexOf(e),r=a<t.length-1?a+1:a;return 0!==t.length?p()(t,(n={},Object(s.a)(n,a,{focussed:{$set:!1}}),Object(s.a)(n,r,{focussed:{$set:!0}}),n)):t};return E(n.frame);case"FOCUS_PREVIOUS":var h=function(e){var n,a=t.indexOf(e),r=a>0?a-1:a;return 0!==t.length?p()(t,(n={},Object(s.a)(n,a,{focussed:{$set:!1}}),Object(s.a)(n,r,{focussed:{$set:!0}}),n)):t};return h(n.frame);case"UPDATE_ACTIVE_FRAMES":var _=function(e){var n=t;console.log(e);var a,r=Object(l.a)(e);try{var i=function(){var e=a.value,r=t.indexOf(t.find((function(t){return t.id===e.id})));n=p()(n,Object(s.a)({},r,{data:{$set:e.data}}))};for(r.s();!(a=r.n()).done;)i()}catch(c){r.e(c)}finally{r.f()}return n};return _(n.frames_to_update);default:return t}},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["Welcome to WBDB UI!"],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_LOG":var n=function(t){return e.length<200?[].concat(Object(f.a)(e),[t]):[].concat(Object(f.a)(e.slice(1,200)),[t])};return n(t.text);default:return e}},h=0,_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_WINDOW":return h+=1,[].concat(Object(f.a)(e),[{id:h,window_type:t.window_type}]);case"REMOVE_WINDOW":return[].concat(Object(f.a)(e.slice(0,e.findIndex((function(e){return e.id===t.id})))),Object(f.a)(e.slice(e.findIndex((function(e){return e.id===t.id}))+1)));default:return e}},O=0,b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_IMAGE_ROI":return O+=1,[].concat(Object(f.a)(e),[{roi_id:O,roi_type:t.roi_type,roi_data:t.roi_data,display_roi:t.display_roi}]);case"UPDATE_IMAGE_ROI_XY":var n=function(){var n=e.findIndex((function(e){return e.roi_id===t.roi_id}));return p()(e,Object(s.a)({},n,{roi_data:{x:{$set:t.roi_new_x},y:{$set:t.roi_new_y}}}))};return n();case"UPDATE_IMAGE_ROI_WH":var a=function(){var n=e.findIndex((function(e){return e.roi_id===t.roi_id}));return p()(e,Object(s.a)({},n,{roi_data:{width:{$set:t.roi_new_w},height:{$set:t.roi_new_h}}}))};return a();case"SET_ROI_DISPLAY":var r=function(){var n=e.findIndex((function(e){return e.roi_id===t.roi_id}));return p()(e,Object(s.a)({},n,{display_roi:{$set:t.display_roi}}))};return r();case"REMOVE_ROI":return[].concat(Object(f.a)(e.slice(0,e.findIndex((function(e){return e.roi_id===t.roi_id})))),Object(f.a)(e.slice(e.findIndex((function(e){return e.roi_id===t.roi_id}))+1)));default:return e}},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"INITIALIZE_OPERATIONS":var n=[],a=function(a){e.some((function(e){return e.operation_name===a}))||n.push({operation_name:a,operation_properties:t.available_ops_list[a]})};for(var r in t.available_ops_list)a(r);return[].concat(Object(f.a)(e),n);case"UPDATE_OPERATION":var i=e.findIndex((function(e){return e.operation_name===t.updated_operation.operation_name})),c=p()(e,Object(s.a)({},i,{operation_properties:{$set:t.updated_operation.operation_properties}}));return c;default:return e}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_NEW_ROUTINE":return[t.new_routine];case"ADD_OPERATION":var n=function(t){var n=e[0];return n.push(t),n};return[n(t.operation)];case"REMOVE_OPERATION":var a=function(t){return[].concat(Object(f.a)(e[0].slice(0,t)),Object(f.a)(e[0].slice(t+1)))};return[a(t.index)];case"CHANGE_OPERATION":var r=function(t,n,a){var r=e[0];return r[t].params[n]=a,r};return[r(t.index,t.param,t.value)];default:return e}},I=Object(o.b)({datatree:u,activeframes:v,loglist:E,openwindows:_,imagerois:b,availableops:y,serverroutine:g}),w=n(138),N=n.n(w),j=n(234),S="/DataBrowse";function R(){return A.apply(this,arguments)}function A(){return(A=Object(j.a)(N.a.mark((function e(){var t,n,a,r=arguments;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(n)});case 4:return a=e.sent,e.abrupt("return",a.json());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){fetch(S+"/getnewestid/").then((function(e){return e.json()})).then((function(t){e(t)})).catch((function(e){return console.log(e)}))}function T(e,t){R(S+"/fetchdata/",{selected:t}).then((function(t){e(t),console.log(t)})).catch((function(e){return console.log(e)}))}var D=function(e){return{type:"SET_FOCUS",frame:e}},k=function(e){return{type:"ADD_LOG",text:e}},x=function(e){return{type:"ADD_WINDOW",window_type:e}},M=function(e,t,n){return{type:"ADD_IMAGE_ROI",roi_type:e,roi_data:t,display_roi:n}},P=function(e,t,n){return{type:"UPDATE_IMAGE_ROI_XY",roi_id:e,roi_new_x:t,roi_new_y:n}},F=function(e){return{type:"SET_NEW_ROUTINE",new_routine:e}},L=function(e,t,n){return{type:"CHANGE_OPERATION",index:e,param:t,value:n}},U=n(235),V=n.n(U);n(250),n(251);var W=function(){var e=Object(c.c)((function(e){return e.datatree})),t=Object(c.b)();return r.a.createElement("div",{className:"DataTree"},r.a.createElement(V.a,{data:e,onChange:function(n,a){T((function(e){t({type:"SET_ACTIVE_FRAMES",active_frames_list:e})}),function e(t){var n=[];for(var a in t)t[a].hasOwnProperty("value")?n.push(Number(t[a].value)):n.push.apply(n,Object(f.a)(e(t[a].children)));return n}(function(e,t){var n=[];for(var a in e){var r=e[a]._id.split("-");r.shift();var i=(r=r.map((function(e){return Number(e)}))).pop(),c=t;for(var o in r)c=c[r[o]].children;c=c[i],n.push(c)}return n}(a,e)))},onFocus:function(){var e;e=function(e){t({type:"LOAD_DATATREE",new_data_tree:e})},fetch(S+"/getdatatree/").then((function(e){return e.json()})).then((function(t){e(t)})).catch((function(e){return console.log(e)}))},keepTreeOnSearch:!0,showPartiallySelected:!0,texts:{placeholder:"Select frames..."}}))},B=n(10),G=(n(252),function(){var e=Object(c.b)(),t=Object(a.useState)(0),n=Object(B.a)(t,2),i=n[0],o=n[1],u=Object(a.useState)(!1),l=Object(B.a)(u,2),s=l[0],f=l[1],d=Object(a.useState)(0),m=Object(B.a)(d,2),p=m[0],v=m[1];return Object(a.useEffect)((function(){var t=setInterval((function(){!function(t,n,a){t&&(C((function(e){v(e)})),a!==n&&(e(k("Detected new frame!")),o(n),T((function(t){e({type:"ADD_ACTIVE_FRAMES",new_frames:t})}),[n])))}(s,p,i)}),1e3);return function(){return clearInterval(t)}}),[s,p,i]),r.a.createElement("div",{className:"NewDataWatcher",active:s.toString(),onClick:function(){return s||(e(k("Watching for new frames...")),C((function(e){v(e),o(e)}))),void f(!s)}},r.a.createElement("div",{className:"displaytext"},"Loading new frames: ",String(s)))}),$=(n(253),function(){var e=Object(c.b)();return r.a.createElement("div",{className:"AddWindowSelection"},r.a.createElement("div",{className:"dropdown"},"Add new window ","\u25bc"),r.a.createElement("div",{className:"dropdown-content"},r.a.createElement("div",{className:"dropdown-selection",onClick:function(){return e(x("SelectedFrames"))}},"Selected frames"),r.a.createElement("div",{className:"dropdown-selection",onClick:function(){return e(x("LogList"))}},"Application logs"),r.a.createElement("div",{className:"dropdown-selection",onClick:function(){return e(x("AttributesList"))}},"Attributes list"),r.a.createElement("div",{className:"dropdown-selection",onClick:function(){return e(x("ImageDisplayer"))}},"Image displayer"),r.a.createElement("div",{className:"dropdown-selection",onClick:function(){return e(x("ROIs"))}},"Display ROIs"),r.a.createElement("div",{className:"dropdown-selection",onClick:function(){return e(x("RoiManager"))}},"ROIs manager"),r.a.createElement("div",{className:"dropdown-selection",onClick:function(){return e(x("ChartDisplayer"))}},"Graph displayer")))}),z=(n(254),function(){var e=Object(c.c)((function(e){return e.activeframes})).map((function(e){return e.id}));return r.a.createElement("div",{className:"FileDownloader"},r.a.createElement("form",{action:S+"/download/",method:"post",id:"formdownload",onSubmit:function(e){return function(e){window.confirm("Zipping files might take a while. Click OK to proceed")||e.preventDefault()}(e)}},r.a.createElement("input",{id:"container_for_ids",type:"hidden",name:"ids",value:[JSON.stringify(e)]}),r.a.createElement("button",{type:"submit"},"Download")))}),H=(n(255),n(139)),q=n.n(H),J=n(51),X=(n(265),function(e){var t=e.variable,n=e.value,a=e.handleValueChange;return r.a.createElement("div",{className:"Variable"},r.a.createElement("label",null,t+": "),r.a.createElement("input",{type:"text",defaultValue:n,onChange:function(e){return a(e.target.value)}}),r.a.createElement("br",null))}),Y=function(e){var t=e.index,n=e.param_name,a=e.value,i=Object(c.b)(),o=Object(c.c)((function(e){return e.imagerois}));return r.a.createElement("div",{className:"VariableDesigner"},r.a.createElement("label",null,n+": "),r.a.createElement("input",{defaultValue:a,type:"text",onChange:function(e){return i(L(t,n,e.target.value))}}),r.a.createElement("select",{onChange:function(e){return function(e){"INIT"!==e&&i(L(t,n,e))}(e.target.value)}},r.a.createElement("option",{value:"INIT"}," Select ROI"),function(e){var t,n=[],a=Object(l.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;for(var c in i.roi_data)n.push(r.a.createElement("option",{value:i.roi_data[c],key:"ID "+i.roi_id+"; "+c},"ID "+i.roi_id+"; "+c))}}catch(o){a.e(o)}finally{a.f()}return n}(o)))},Z=function(e){var t=e.operation,n=e.index,a=Object(c.b)();return r.a.createElement("div",{className:"Operation"},r.a.createElement("div",null,t.operation," ",r.a.createElement("button",{className:"close",onClick:function(){return a(function(e){return{type:"REMOVE_OPERATION",index:e}}(n))}},"\u2715")),r.a.createElement("div",null,function(){var e=[];for(var a in t.params)e.push(r.a.createElement(Y,{key:a,index:n,param_name:a,value:t.params[a]}));return e}()))},K=function(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.serverroutine}))[0],n=Object(c.c)((function(e){return e.availableops})),i=Object(a.useState)("INIT"),o=Object(B.a)(i,2),u=o[0],s=o[1];return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("select",{value:u,onChange:function(e){return s(e.target.value)}},r.a.createElement("option",{value:"INIT"},"Select operation"),function(e){var t,n,a=[],i=Object(l.a)(e);try{for(i.s();!(t=i.n()).done;){var c=t.value;a.push(r.a.createElement("option",{value:JSON.stringify((n=c,{operation:n.operation_name,params:n.operation_properties.variables})),key:c.operation_name},c.operation_name))}}catch(o){i.e(o)}finally{i.f()}return a}(n)),r.a.createElement("button",{onClick:function(){var t;"INIT"!==(t=u)&&e(function(e){return{type:"ADD_OPERATION",operation:e}}(JSON.parse(t)))}},"Add operation")),r.a.createElement("div",null,function(e){var t,n=[],a=Object(l.a)(e.entries());try{for(a.s();!(t=a.n()).done;){var i=Object(B.a)(t.value,2),c=i[0],o=i[1];n.push(r.a.createElement(Z,{operation:o,index:c,key:c}))}}catch(u){a.e(u)}finally{a.f()}return n}(t)),r.a.createElement("div",{className:"UploadNewRoutineSpace"},r.a.createElement("button",{onClick:function(){return n=function(t){return e(k(t))},void R(S+"/setRoutine/",{new_routine:t}).then((function(){return n("Routine updated")})).catch((function(e){return console.log(e)}));var n}},"Upload new routine")))};q.a.setAppElement("#root");var Q={content:{top:"40%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",fontFamily:"Arial, Helvetica, sans-serif",background:"#f4f4f4"},overlay:{backgroundColor:"rgba(0,0,0,0.4)"}},ee=function(e,t){return"FOCUSSED"===t?function(e){var t,n=Object(l.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(!0===a.focussed)return[a.id]}}catch(r){n.e(r)}finally{n.f()}return[]}(e):function(e,t){var n,a=[],r=Object(l.a)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.data.sequence_name===t&&a.push(i.id)}}catch(c){r.e(c)}finally{r.f()}return a}(e,t)},te=function(){var e=Object(c.b)(),t=Object(a.useState)(!1),n=Object(B.a)(t,2),i=n[0],o=n[1],u=function(){var t;t=function(t){return e(F(t))},fetch(S+"/fetchRoutine/").then((function(e){return e.json()})).then((function(e){return t(e)})).catch((function(e){return console.log(e)})),function(e){fetch(S+"/fetchOps/").then((function(e){return e.json()})).then((function(t){e(t)})).catch((function(e){return console.log(e)}))}((function(t){return e({type:"INITIALIZE_OPERATIONS",available_ops_list:t})})),o(!0)},s=Object(c.c)((function(e){return e.availableops})),f=Object(c.c)((function(e){return e.activeframes})),d=function(e){var t,n=[],a=Object(l.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n.includes(r.data.sequence_name)||n.push(r.data.sequence_name)}}catch(i){a.e(i)}finally{a.f()}return n}(f),m=Object(a.useState)("FOCUSSED"),p=Object(B.a)(m,2),v=p[0],E=p[1],h=Object(a.useState)({}),_=Object(B.a)(h,2),O=_[0],b=_[1],y=Object(a.useState)("INIT"),g=Object(B.a)(y,2),I=g[0],w=g[1],N=Object(c.c)((function(e){return e.imagerois})),j=Object(a.useState)("INIT"),A=Object(B.a)(j,2),C=A[0],D=A[1],x=function(e,t,n){var a=e;a.operation_properties.variables[t]=n,b(a)};return r.a.createElement("div",{className:"OperationsMenuButton"},r.a.createElement("button",{onClick:function(){return u()}},"Operations menu"),r.a.createElement(q.a,{isOpen:i,style:Q,shouldCloseOnOverlayClick:!0,onRequestClose:function(){return o(!1)}},r.a.createElement(J.d,null,r.a.createElement(J.b,null,r.a.createElement(J.a,null,"Dispatch operation"),r.a.createElement(J.a,null,"Routines designer")),r.a.createElement(J.c,null,r.a.createElement("div",null,r.a.createElement("h2",null,"Operations Menu"),r.a.createElement("h3",null,"Selected frames"),r.a.createElement("select",{value:v,onChange:function(e){return E(e.target.value)}},r.a.createElement("option",{key:"FOCUSSED",value:"FOCUSSED"},"Currently focussed frame"),d.map((function(e){return function(e){return r.a.createElement("option",{key:e,value:e},e)}(e)}))),r.a.createElement("h3",null,"Operation options"),r.a.createElement("select",{value:I,onChange:function(e){return t=e.target.value,w(t),void b(s.find((function(e){return e.operation_name===t})));var t}},r.a.createElement("option",{key:"INIT",value:"INIT"}," Select operation"),s.map((function(e){return function(e){var t=e.operation_name;return r.a.createElement("option",{key:t,value:t},t)}(e)})))," ",r.a.createElement("br",null),"bind to ROI:",r.a.createElement("select",{value:C,onChange:function(e){return D(e.target.value)}},r.a.createElement("option",{value:"INIT"}," Nothing "),N.map((function(e){return r.a.createElement("option",{key:e.roi_id,value:e.roi_id},"ID: ",e.roi_id)}))),function(e,t){var n=[],a=void 0===t?{}:t;try{var i=function(t){a.hasOwnProperty("roi_data")&&a.roi_data.hasOwnProperty(t)||n.push(r.a.createElement(X,{variable:t,value:e.operation_properties.variables[t],handleValueChange:function(e){return x(O,t,e)},key:t}))};for(var c in e.operation_properties.variables)i(c)}catch(o){return r.a.createElement("h4",null,"Select operation")}return n}(O,N.find((function(e){return e.roi_id==C})))),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){"INIT"!==I&&function(e,t,n,a,r){a("Starting "+n+"..."),R(S+"/do/",{selected:e,parameters:t,operation:n}).then((function(e){return a(e)})).then((function(){return T(r,e)})).catch((function(e){return console.log(e)}))}(ee(f,v),function(e,t){var n=e.hasOwnProperty("operation_properties")?e:{operation_properties:{variables:{}}},a=void 0===t?{roi_data:{}}:t,r={};for(var i in n.operation_properties.variables)a.roi_data.hasOwnProperty(i)?r[i]=a.roi_data[i]:r[i]=n.operation_properties.variables[i];return r}(O,N.find((function(e){return e.roi_id==C}))),I,(function(t){return e(k(t))}),(function(t){return e({type:"UPDATE_ACTIVE_FRAMES",frames_to_update:t})}))}},"Dispatch!"))),r.a.createElement(J.c,null,r.a.createElement(K,null)))))},ne=(n(266),function(){return r.a.createElement("div",{className:"MenuBar"},r.a.createElement(W,null),r.a.createElement(z,null),r.a.createElement(G,null),r.a.createElement(te,null),r.a.createElement($,null))}),ae=(n(267),n(65)),re=(n(270),function(e){var t=Object(c.b)();return r.a.createElement(ae.a,{bounds:".WorkSpace",className:"WindowWrapper",dragHandleClassName:"header",resizeGrid:[20,20],dragGrid:[20,20],default:{x:0,y:0,width:e.default_width,height:e.default_height},lockAspectRatio:e.lock_aspect_ratio,enableResizing:e.resizable},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"header-name"},e.window_name+" (id: "+e.id+")"),r.a.createElement("div",{className:"header-close",onClick:function(){return t({type:"REMOVE_WINDOW",id:e.id})}},"\u2715")),e.children)}),ie=(n(271),function(e){var t="";try{t=""+(t=e.data.results.simpleSubtraction.value)}catch(n){t="/static/DataBrowse/img/no_img.png"}return t}),ce=function(e){var t=e.data_frame,n=Object(c.b)();return r.a.createElement("div",{className:"DataTile",focussed:t.focussed.toString()},r.a.createElement("div",{className:"TileContent",onClick:function(){return n(D(t))}},r.a.createElement("img",{className:"TileImage",src:ie(t),height:70,width:70}),t.data.name+"  (ID: "+t.id+")"),r.a.createElement("div",{className:"close",onClick:function(){return n({type:"REMOVE_ONE_OF_ACTIVE_FRAMES",frame_to_remove:t})}},"\u2715"))},oe=(n(272),function(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.activeframes})).find((function(e){return!0===e.focussed}));return r.a.createElement("div",null,r.a.createElement("button",{className:"NavigButton",onClick:function(){return e({type:"FOCUS_PREVIOUS",frame:t})}}," ","\u25c0"," "),r.a.createElement("button",{className:"NavigButton",onClick:function(){return e({type:"CLEAR_FRAMES"})}}," Clear "),r.a.createElement("button",{className:"NavigButton",onClick:function(){return e({type:"FOCUS_NEXT",frame:t})}}," ","\u25b6"," "))}),ue=(n(273),function(){var e=Object(c.c)((function(e){return e.activeframes})),t=e.find((function(e){return!0===e.focussed})),n=Object(a.useRef)(null),i=Object(a.useRef)(null);return Object(a.useEffect)((function(){return function(e,t){if(null!==e.current){var n=e.current.offsetTop-t.current.scrollTop;(n>t.current.clientHeight||n<0)&&t.current.scrollTo(0,e.current.offsetTop-100)}}(n,i)})),r.a.createElement("div",{className:"SelectedFramesList"},r.a.createElement(oe,null),r.a.createElement("div",{className:"TilesSpace",ref:i},e.map((function(e){return e.id===t.id?r.a.createElement("div",{ref:n,key:e.id},r.a.createElement(ce,{key:e.id,data_frame:e})):r.a.createElement("div",{key:e.id},r.a.createElement(ce,{key:e.id,data_frame:e}))}))))}),le=(n(274),function(){var e=Object(c.c)((function(e){return e.loglist})),t=r.a.createRef();return Object(a.useEffect)((function(){t.current.scrollTop=t.current.scrollHeight})),r.a.createElement("div",{className:"Console",ref:t},r.a.createElement("ul",null,e.map((function(e,t){return r.a.createElement("li",{key:e+t},e)}))))}),se=function(e){return void 0!==e?r.a.createElement("td",null,e):""},fe=function(e){var t=e.props;return r.a.createElement("tr",null,se(t.name),se(t.type),se(t.value))},de=(n(275),function(){var e=Object(c.c)((function(e){return e.activeframes})).find((function(e){return!0===e.focussed})),t=Object(a.useState)("PROPS"),n=Object(B.a)(t,2),i=n[0],o=n[1];return r.a.createElement("div",{className:"FrameAttributesList"},r.a.createElement("label",null,"Display:",r.a.createElement("select",{value:i,onChange:function(e){return o(e.target.value)}},r.a.createElement("option",{value:"PROPS"},"Properties"),r.a.createElement("option",{value:"RES"},"Results"))),r.a.createElement("div",{className:"tableSpace"},r.a.createElement("table",null,r.a.createElement("tbody",null,"RES"===i?r.a.createElement("tr",null,r.a.createElement("th",null,"Result Name"),r.a.createElement("th",null,"Result Type"),r.a.createElement("th",null,"Result Value")):r.a.createElement("tr",null,r.a.createElement("th",null,"Property Name"),r.a.createElement("th",null,"Property Value")),function(t,n){if(void 0===t)return[];var a=[],r="PROPS"===n?e.data.properties:e.data.results;for(var i in r)"RES"===n?a.push({name:i,type:r[i].type,value:r[i].value}):a.push({name:i,value:r[i]});return a}(e,i).map((function(e,t){return r.a.createElement(fe,{key:t,props:e})}))))))}),me=function(e,t){var n="";try{n=""+(n=e.data.results[t].value)}catch(a){n="/static/DataBrowse/img/no_img.png"}return n},pe=function(e){return r.a.createElement("img",{className:"SelectedImage",src:me(e.data_frame,e.selection)})};n(276);var ve=function(){var e=Object(c.c)((function(e){return e.activeframes})).find((function(e){return!0===e.focussed})),t=function(e){var t=[];if(void 0!==e)for(var n in e.data.results)"IMG"===e.data.results[n].type&&t.push(n);else t.push("None");return t}(e),n=Object(a.useState)("INIT"),i=Object(B.a)(n,2),o=i[0],u=i[1];return r.a.createElement("div",{className:"ImageDisplayer"},r.a.createElement("div",{className:"ResultSelect"},r.a.createElement("select",{value:o,onChange:function(e){return u(e.target.value)}},r.a.createElement("option",{value:"INIT"},"Select result to show"),t.map((function(e,t){return r.a.createElement("option",{key:t,value:e},e)})))),r.a.createElement(pe,{data_frame:e,selection:o}))},Ee=function(e,t){var n="";try{n=""+(n=e.data.results[t].value)}catch(a){n="/static/DataBrowse/img/no_img.png"}return n},he=function(e){return r.a.createElement("div",{className:"SelectedImageRoi"},r.a.createElement("img",{className:"ImageRoi",src:Ee(e.data_frame,e.selection),onLoad:function(t){return e.imgOnload(t.target.naturalWidth,t.target.naturalHeight)}}),e.children)};n(277);var _e=function(e){var t=Object(c.c)((function(e){return e.activeframes})).find((function(e){return!0===e.focussed})),n=function(e){var t=[];if(void 0!==e)for(var n in e.data.results)"IMG"===e.data.results[n].type&&t.push(n);else t.push("None");return t}(t),i=Object(a.useState)("INIT"),o=Object(B.a)(i,2),u=o[0],l=o[1];return r.a.createElement("div",{className:"ImageDisplayerRoi"},r.a.createElement("div",{className:"ResultSelect"},r.a.createElement("select",{value:u,onChange:function(e){return l(e.target.value)}},r.a.createElement("option",{value:"INIT"},"Select result to show"),n.map((function(e,t){return r.a.createElement("option",{key:t,value:e},e)})))),r.a.createElement(he,{data_frame:t,selection:u,imgOnload:e.imgOnload},e.children))},Oe=function(e){var t=e.placement,n=e.id,a=e.onDrag,i=e.onResize;return r.a.createElement(ae.a,{position:{x:t.x,y:t.y},size:{width:t.width,height:t.height},title:n,bounds:".SelectedImageRoi",onDragStop:function(e,t){a(n,t.x,t.y)},onResizeStop:function(e,t,a,r,c){i(n,c.x,c.y,a.offsetWidth,a.offsetHeight)}},r.a.createElement("div",{className:"Rectangle"}))},be=function(e){var t=e.placement,n=e.id,a=e.onDrag;return r.a.createElement(ae.a,{position:{x:t.x,y:t.y},size:{width:20,height:20},title:n,enableResizing:!1,bounds:".SelectedImageRoi",onDragStop:function(e,t){a(n,t.x,t.y)}},r.a.createElement("div",{className:"Point"},"\u2715"))},ye=(n(278),function(){var e=Object(a.useState)(0),t=Object(B.a)(e,2),n=t[0],i=t[1],o=Object(a.useState)(0),u=Object(B.a)(o,2),l=(u[0],u[1]),s=Object(c.b)(),f=function(e){var t=n/600;return t>1?{x:Math.floor(e.x/t),y:Math.floor(e.y/t),width:Math.floor(e.width/t),height:Math.floor(e.height/t)}:e},d=function(e){var t=n/600;return t>1?{x:Math.floor(e.x/t-12),y:Math.floor(e.y/t-12)}:{x:Math.floor(e.x-12),y:Math.floor(e.y-12)}},m=function(e){var t=n/600;return t>1?Math.floor(e*t):e},p=function(e){var t=n/600;return t>1?Math.floor(e*t+12*t):e+12},v=function(e,t,n){s(P(e,m(t),m(n)))},E=function(e,t,n){s(P(e,p(t),p(n)))},h=function(e,t,n,a,r){var i,c,o;s(P(e,m(t),m(n))),s((i=e,c=m(a),o=m(r),{type:"UPDATE_IMAGE_ROI_WH",roi_id:i,roi_new_w:c,roi_new_h:o}))},_=Object(c.c)((function(e){return e.imagerois})).filter((function(e){return!0===e.display_roi}));return r.a.createElement("div",{className:"SelectRoi"},r.a.createElement(_e,{imgOnload:function(e,t){i(e),l(t)}},_.map((function(e){return function(e){switch(e.roi_type){case"RECTANGLE":return r.a.createElement(Oe,{key:e.roi_id,id:e.roi_id,placement:f(e.roi_data),onDrag:v,onResize:h});case"POINT":return r.a.createElement(be,{key:e.roi_id,id:e.roi_id,placement:d(e.roi_data),onDrag:E})}}(e)}))))}),ge=(n(279),function(e){var t=e.roi,n=Object(c.b)();return r.a.createElement("div",{className:"RoiTile"},"ROI ID: ",t.roi_id," ",r.a.createElement("input",{type:"checkbox",checked:t.display_roi,onClick:function(){return n((e=t.roi_id,a=!t.display_roi,{type:"SET_ROI_DISPLAY",roi_id:e,display_roi:a}));var e,a}}),r.a.createElement("div",{className:"close",onClick:function(){return n({type:"REMOVE_ROI",roi_id:t.roi_id})}},"\u2715"),r.a.createElement("br",null),"type: ",t.roi_type," ",r.a.createElement("br",null),JSON.stringify(t.roi_data,null,1))}),Ie=(n(280),{x:0,y:0,width:200,height:200}),we={x:200,y:200},Ne=function(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.imagerois}));return r.a.createElement("div",{className:"RoiManager"},r.a.createElement("div",{className:"RoiButtons"},r.a.createElement("button",{className:"AddButton",onClick:function(){return e(M("RECTANGLE",Ie,!0))}},"Add rectangle"),r.a.createElement("button",{className:"AddButton",onClick:function(){return e(M("POINT",we,!0))}},"Add point")),r.a.createElement("div",{className:"RoisList"},t.map((function(e){return r.a.createElement(ge,{key:e.roi_id,roi:e})}))))},je=n(238),Se=n.n(je),Re=(n(585),["#111d5e","#c70039","#f37121","#ffbd69","#086972","#01a9b4","#87dfd6","#fbfd8a","#184d47","#96bb7c"]),Ae=function(e){return"Result: "+e},Ce=function(e){return"Property: "+e},Te=function(e,t){var n=t.slice(0,1),a=t.slice(1),r={};switch(n){case"p":var i,c=Object(l.a)(e);try{for(c.s();!(i=c.n()).done;){var o=i.value;try{r[o.id]=o.data.properties[a]}catch(d){}}}catch(m){c.e(m)}finally{c.f()}case"r":var u,s=Object(l.a)(e);try{for(s.s();!(u=s.n()).done;){var f=u.value;try{r[f.id]=f.data.results[a].value}catch(d){}}}catch(m){s.e(m)}finally{s.f()}}return r},De=function(e){var t,n=function(e){var t,n=[],a=Object(l.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n.includes(r.data.sequence_name)||n.push(r.data.sequence_name)}}catch(i){a.e(i)}finally{a.f()}return n}(e),a={},r=Object(l.a)(n.entries());try{for(r.s();!(t=r.n()).done;){var i=Object(B.a)(t.value,2),c=i[0];a[i[1]]=Re[c%Re.length]}}catch(d){r.e(d)}finally{r.f()}var o,u={},s=Object(l.a)(e);try{for(s.s();!(o=s.n()).done;){var f=o.value;u[f.id]=a[f.data.sequence_name]}}catch(d){s.e(d)}finally{s.f()}return u},ke=function(e,t,n,a,r){var i="",c="";"p"!==t[0]&&"r"!==t[0]||(i=t.slice(1)),"p"!==n[0]&&"r"!==n[0]||(c=n.slice(1));var o,u={backgroundColor:"#f4f4f4",tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{min:a.min_x,max:a.max_x,name:i,nameLocation:"center",type:"value",splitLine:{lineStyle:{type:"dashed"}}},yAxis:{min:a.min_y,max:a.max_y,name:c,type:"value",splitLine:{lineStyle:{type:"dashed"}}},series:[]},s=Object(l.a)(e);try{for(s.s();!(o=s.n()).done;){var f=o.value;u.series.push({name:f.id,data:[f.data],type:"scatter",color:r[f.id],emphasis:{label:{show:!0,position:"left",color:"black",fontSize:16}}})}}catch(d){s.e(d)}finally{s.f()}return u},xe=function(e,t){var n,a=[],r=Object(l.a)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;a.push(i.data)}}catch(c){r.e(c)}finally{r.f()}!function(e,t){for(var n=function(e){for(var t="",n=0;n<e.length;n++){var a=null===e[n]?"":e[n].toString();e[n]instanceof Date&&(a=e[n].toLocaleString());var r=a.replace(/"/g,'""');r.search(/("|,|\n)/g)>=0&&(r='"'+r+'"'),n>0&&(t+=","),t+=r}return t+"\n"},a="",r=0;r<t.length;r++)a+=n(t[r]);var i=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,e);else{var c=document.createElement("a");if(void 0!==c.download){var o=URL.createObjectURL(i);c.setAttribute("href",o),c.setAttribute("download",e),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}}}(e,a)},Me=function(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.activeframes})),n=De(t),i=Object(a.useState)("INIT"),o=Object(B.a)(i,2),u=o[0],s=o[1],f=Object(a.useState)("INIT"),d=Object(B.a)(f,2),m=d[0],p=d[1],v=function(e){var t,n={},a=[],r=[],i=Object(l.a)(e);try{for(i.s();!(t=i.n()).done;){var c=t.value;for(var o in c.data.properties)a.includes(o)||a.push(o);for(var u in c.data.results)r.includes(u)||"NUM"!==c.data.results[u].type||r.push(u)}}catch(s){i.e(s)}finally{i.f()}return n.properties=a,n.results=r,n}(t),E=function(e,t){var n=[];for(var a in e)if(t.hasOwnProperty(a)){var r={};r.id=a,r.data=[Number(e[a]),Number(t[a])],n.push(r)}return n}(Te(t,u),Te(t,m)),h=function(e){var t=e.map((function(e){return e.data[0]})),n=e.map((function(e){return e.data[1]})),a=Math.min.apply(null,t),r=Math.max.apply(null,t),i=Math.min.apply(null,n),c=Math.max.apply(null,n),o=r-a,u=c-i;return{min_x:a-.05*o,max_x:r+.05*o,min_y:i-.05*u,max_y:c+.05*u}}(E),_={click:function(n){return e(D(t.find((function(e){return e.id===Number(n.seriesName)}))))}};return r.a.createElement("div",{className:"ChartDisplayer"},r.a.createElement("div",{className:"ChartSelector"},"Select X:",r.a.createElement("select",{value:u,onChange:function(e){return s(e.target.value)}},r.a.createElement("option",{value:"INIT"},"Select values source"),v.properties.map((function(e,t){return r.a.createElement("option",{key:"p"+String(t),value:"p"+e},Ce(e))})),v.results.map((function(e,t){return r.a.createElement("option",{key:"r"+String(t),value:"r"+e},Ae(e))}))),"Select Y:",r.a.createElement("select",{value:m,onChange:function(e){return p(e.target.value)}},r.a.createElement("option",{value:"INIT"},"Select values source"),v.properties.map((function(e,t){return r.a.createElement("option",{key:"p"+String(t),value:"p"+e},Ce(e))})),v.results.map((function(e,t){return r.a.createElement("option",{key:"r"+String(t),value:"r"+e},Ae(e))}))),r.a.createElement("button",{onClick:function(){return xe("result.csv",E)}},"Download")),r.a.createElement(Se.a,{option:ke(E,u,m,h,n),onEvents:_,style:{height:"calc(100% - 30px)",width:"100%"}}))},Pe=function(e){return r.a.createElement(re,{id:e.id,window_name:"Application logs",default_width:400,default_height:120},r.a.createElement(le,null))},Fe=function(e){return r.a.createElement(re,{id:e.id,window_name:"Selected frames",default_width:250,default_height:520},r.a.createElement(ue,null))},Le=function(e){return r.a.createElement(re,{id:e.id,window_name:"ROIs manager",default_width:340,default_height:320},r.a.createElement(Ne,null))},Ue=function(e){return r.a.createElement(re,{id:e.id,window_name:"Data frame atributes",default_width:600,default_height:280},r.a.createElement(de,null))},Ve=function(e){return r.a.createElement(re,{id:e.id,window_name:"Image displayer",default_width:400,default_height:452,lock_aspect_ratio:!0},r.a.createElement(ve,null))},We=function(e){return r.a.createElement(re,{id:e.id,window_name:"ROIs",default_width:600,default_height:600,resizable:!1},r.a.createElement(ye,null))},Be=function(e){return r.a.createElement(re,{id:e.id,window_name:"Chart",default_width:600,default_height:400},r.a.createElement(Me,null))},Ge=function(){var e=Object(c.c)((function(e){return e.openwindows}));return r.a.createElement("div",{className:"WorkSpace"},e.map((function(e){return function(e){var t=e.id;switch(e.window_type){case"SelectedFrames":return r.a.createElement(Fe,{key:t,id:t});case"LogList":return r.a.createElement(Pe,{key:t,id:t});case"AttributesList":return r.a.createElement(Ue,{key:t,id:t});case"ImageDisplayer":return r.a.createElement(Ve,{key:t,id:t});case"ROIs":return r.a.createElement(We,{key:t,id:t});case"RoiManager":return r.a.createElement(Le,{key:t,id:t});case"ChartDisplayer":return r.a.createElement(Be,{key:t,id:t});default:console.log("Unknown window")}}(e)})))},$e=(n(586),function(){return r.a.createElement("div",null,r.a.createElement(ne,null),r.a.createElement(Ge,null))}),ze=Object(o.c)(I);Object(i.render)(r.a.createElement(c.a,{store:ze},r.a.createElement($e,null)),document.getElementById("root"))}},[[239,1,2]]]);
//# sourceMappingURL=main.c0822944.chunk.js.map